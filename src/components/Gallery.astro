---
import { Image, getImage } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
	images: ImageMetadata[];
	columns?: number;
	title?: string;
	alts?: string[];
	captions?: string[];
}

const { images, columns = 3, title, alts, captions } = Astro.props;
const galleryId = `gallery-${Math.random().toString(36).substr(2, 9)}`;

const fullSizeUrls = await Promise.all(
	images.map(img => getImage({ src: img, format: 'webp' }).then(r => r.src))
);
---

{title && <h3>{title}</h3>}
<div class="gallery" style={`--columns: ${columns}`} id={galleryId} role="region" aria-label={title || 'Image gallery'}>
	{images.map((src, index) => (
		<div class={`gallery-cell${captions ? ' has-caption' : ''}`}>
			<a
				href={fullSizeUrls[index]}
				class="glightbox gallery-item"
				data-gallery={galleryId}
				data-type="image"
			>
				<Image
					src={src}
					alt={alts?.[index] || `Gallery image ${index + 1}`}
					width={400}
					height={300}
					loading="lazy"
				/>
			</a>
			{captions?.[index] && (
				<p class="gallery-caption">{captions[index]}</p>
			)}
		</div>
	))}
</div>

<!-- GLightbox initialization handled by BlogPost layout -->

<style>
	.gallery {
		display: grid;
		grid-template-columns: repeat(var(--columns), 1fr);
		gap: 1rem;
		margin: 2rem 0;
	}

	.gallery-item {
		position: relative;
		overflow: hidden;
		border-radius: 8px;
		cursor: pointer;
		transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
		text-decoration: none;
		display: block;
		border: 1px solid var(--border-color);
	}

	.gallery-item:hover {
		transform: scale(1.03);
		box-shadow: var(--glow-blue);
		border-color: var(--border-glow);
	}

	.gallery-item img {
		width: 100%;
		height: 200px;
		object-fit: cover;
		display: block;
	}

	.gallery-cell {
		display: flex;
		flex-direction: column;
	}

	.gallery-cell .gallery-item {
		flex-shrink: 0;
	}

	.gallery-caption {
		margin: 0.5rem 0 0 0;
		font-size: 0.85rem;
		font-style: italic;
		color: var(--text-muted);
		text-align: center;
		line-height: 1.4;
	}

	/* Responsive */
	@media (max-width: 768px) {
		.gallery {
			grid-template-columns: repeat(2, 1fr);
		}
	}

	@media (max-width: 480px) {
		.gallery {
			grid-template-columns: 1fr;
		}
	}
</style>
