---
import Gallery from './Gallery.astro';
import type { ImageMetadata } from 'astro';

interface Props {
	postSlug: string;
	galleryName?: string;
	columns?: number;
	title?: string;
}

const { postSlug, galleryName = 'gallery', columns = 3, title } = Astro.props;

const allGalleryImages = import.meta.glob<{ default: ImageMetadata }>(
	'/src/assets/images/posts/**/gallery*/*.{jpg,jpeg,png,gif,webp}',
	{ eager: true }
);

const images: ImageMetadata[] = Object.entries(allGalleryImages)
	.filter(([path]) => {
		const segments = path.split('/');
		const postsIdx = segments.indexOf('posts');
		if (postsIdx === -1) return false;
		const slug = segments[postsIdx + 1];
		const gallery = segments[postsIdx + 2];
		return slug === postSlug && gallery === galleryName;
	})
	.sort(([a], [b]) => a.localeCompare(b))
	.map(([, mod]) => mod.default);
---

{images.length > 0 && (
	<Gallery images={images} columns={columns} title={title} />
)}

{images.length === 0 && (
	<p><em>Gallery images not found for: {postSlug}/{galleryName}/</em></p>
)}
